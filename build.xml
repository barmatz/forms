<project name="FormS build script" basedir="." default="run">
	<property file="build.properties"/>
	
	<target name="clean">
		<delete dir="${BIN_DIR}"/>
		<delete dir="${SERVER_DIR}"/>
	</target>
	
	<target name="init" depends="clean">
		<mkdir dir="${SERVER_DIR}"/>
		<mkdir dir="${BIN_DIR}"/>
		<mkdir dir="${BIN_DIR}/js"/>
		<mkdir dir="${BIN_DIR}/css"/>
		<mkdir dir="${BIN_DIR}/tests"/>
	</target>
	
	<target name="build" depends="init">
		<concat destfile="${BIN_DIR}/js/application.js" fixlastline="yes">
			<fileset dir="${SRC_DIR}" includes="namespaces.js"/>
			<fileset dir="${SRC_DIR}/barmatz/utils" includes="**/*.js"/>
			<fileset dir="${SRC_DIR}/barmatz/events" includes="Event.js"/>
			<fileset dir="${SRC_DIR}/barmatz/events" includes="**/*.js" excludes="Event.js"/>
			<fileset dir="${SRC_DIR}/barmatz/mvc" includes="**/*.js"/>
			<fileset dir="${SRC_DIR}/barmatz/forms" includes="TypeModel.js"/>
			<fileset dir="${SRC_DIR}/barmatz/forms/fields" includes="FormFieldModel.js"/>
			<fileset dir="${SRC_DIR}/barmatz/forms/fields" includes="FormTextFieldModel.js"/>
			<fileset dir="${SRC_DIR}/barmatz/forms/fields" includes="**/*.js" excludes="FormFieldModel.js FormTextFieldModel.js"/>
			<fileset dir="${SRC_DIR}/barmatz/forms" includes="**/*.js" excludes="TypeModel.js fields/**.js"/>
			<fileset dir="${SRC_DIR}/barmatz/net" includes="**/*.js"/>
		</concat>
		<concat destfile="${BIN_DIR}/css/main.css" fixlastline="yes">
			<fileset dir="${SRC_DIR}" includes="reset.css"/>
			<fileset dir="${SRC_DIR}" includes="**/*.css" excludes="reset.css"/>
		</concat>
		<copy todir="${BIN_DIR}/js">
			<fileset dir="${SRC_DIR}" includes="*.js"/>
		</copy>
		<copy todir="${BIN_DIR}">
			<fileset dir="${SRC_DIR}" includes="**/*.*" excludes="**/*.js **/*.css"/>
		</copy>
		<copy todir="${BIN_DIR}">
			<fileset dir="${LIB_DIR}"/>
		</copy>
		<copy todir="${BIN_DIR}/tests">
			<fileset dir="${TEST_DIR}"/>
		</copy>
	</target>

	<target name="distribute" depends="build">
		<copy todir="${SERVER_DIR}">
			<fileset dir="${BIN_DIR}"/>
		</copy>
	</target>
	
	<target name="run" depends="distribute">
		<!--<exec executable="rundll32.exe">
			<arg line="url.dll, FileProtocolHandler"/>
			<arg line="${SERVER_URI}"/>
		</exec>-->
	</target>
</project>